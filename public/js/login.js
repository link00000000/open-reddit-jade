// Generated by CoffeeScript 1.12.1
var changeMenu, closeMenu, copyToken, createMailto, logout, menuOpen, openMenu;

menuOpen = false;

$(function() {
  $('#login-cta').click(function() {
    menuOpen = !menuOpen;
    if (menuOpen) {
      return openMenu();
    } else {
      return closeMenu();
    }
  });
  $('.back-arrow').click(function() {
    return changeMenu('main');
  });
  return $('form#token_auth').submit(function(e) {
    var token;
    token = $(this).serializeArray()[0].value;
    $.post('authorize_callback', {
      token: token
    });
    e.preventDefault();
    return false;
  });
});

openMenu = function() {
  $('#login-wrapper').addClass('transitioning');
  $('#login-wrapper').stop().fadeIn(150, function() {
    return $('#login-wrapper').removeClass('transitioning');
  });
  return false;
};

closeMenu = function() {
  $('#login-wrapper').addClass('transitioning');
  $('#login-wrapper').stop().fadeOut(150, function() {
    return $('#login-wrapper').removeClass('transitioning');
  });
  changeMenu('main');
  return false;
};

changeMenu = function(elem) {
  $('#login-wrapper').children().each(function() {
    if ($(this).css('display') !== 'none') {
      return $(this).fadeOut(150, function() {
        return $('#login-wrapper #' + elem).fadeIn(150);
      });
    }
  });
  return false;
};

logout = function() {
  $.post('/logout');
  document.location = '/';
  return false;
};

createMailto = function() {
  var email, link, token;
  email = prompt('Please enter your Email to send the token');
  token = $('#modal-text').text();
  link = "https://mail.google.com/mail/?view=cm&ui=2&tf=0&fs=1&to=" + email + "&su=Open%20Reddit%20Token&body=" + token;
  window.open(link, 'Reddit Token - Email', 'directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,width=400,height=350');
  $('#modal-text').css({
    'width': $('#modal-text').width(),
    'color': $('body').css('background-color'),
    'font-weight': 'bold'
  }).text('Email Created');
  setTimeout(function() {
    return $('#modal-text').css({
      'width': 'auto',
      'color': $('#title #main').css('color'),
      'font-weight': 'normal'
    }).text(token);
  }, 3000);
  console.log("Created Email");
  return false;
};

copyToken = function() {
  var dummy, token;
  token = $('#modal-text').text();
  dummy = document.createElement('input');
  document.body.appendChild(dummy);
  dummy.setAttribute('id', 'loginToken');
  document.getElementById('loginToken').value = token;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  $('#modal-text').css({
    'width': $('#modal-text').width(),
    'color': $('body').css('background-color'),
    'font-weight': 'bold'
  }).text('Copied Token to Clipboard');
  setTimeout(function() {
    return $('#modal-text').css({
      'width': 'auto',
      'color': $('#title #main').css('color'),
      'font-weight': 'normal'
    }).text(token);
  }, 3000);
  console.log("Copied token");
  return false;
};

$('#modal-overlay').click(function() {
  return $('#modal-overlay').remove();
}).children().click(function() {
  return false;
});
